/**/FUNCTION ZHR_PC_PUBLIC_010.
*"----------------------------------------------------------------------
*"*"本地接口：
*"  IMPORTING
*"     VALUE(I_BEGDA) TYPE  SY-DATUM OPTIONAL
*"     VALUE(I_ENDDA) TYPE  SY-DATUM OPTIONAL
*"     VALUE(I_OBJID) TYPE  HROBJID OPTIONAL
*"  TABLES
*"      OT_GZRL STRUCTURE  PA0000
*"      OT_GZRL1 STRUCTURE  PA0000
*"      OT_GZRL2 STRUCTURE  PA0000
*"      OT_GZRL3 STRUCTURE  PA0000
*"----------------------------------------------------------------------
  DATA : LT_OBJEC TYPE TABLE OF OBJEC WITH HEADER LINE,
         LT_STRUC TYPE TABLE OF STRUC WITH HEADER LINE.
  DATA : LT_BEGDA LIKE SY-DATUM,LT_ENDDA LIKE SY-DATUM,L_PERNR LIKE PERNR-PERNR.
  DATA : LT_PERWS LIKE TABLE OF PTPSP WITH HEADER LINE.

  CALL FUNCTION 'RH_STRUC_GET'
    EXPORTING
      ACT_OTYPE      = 'O'
      ACT_OBJID      = I_OBJID
      ACT_WEGID      = 'O-S-P'
      ACT_PLVAR      = '01'
      ACT_BEGDA      = I_BEGDA
      ACT_ENDDA      = I_ENDDA
*     authority_check = 'x'
    TABLES
      RESULT_OBJEC   = LT_OBJEC
      RESULT_STRUC   = LT_STRUC
    EXCEPTIONS
      NO_PLVAR_FOUND = 1
      NO_ENTRY_FOUND = 2
      OTHERS         = 3.

  DELETE LT_STRUC WHERE OTYPE NE  'P' .
  LOOP AT LT_STRUC WHERE OTYPE = 'P' AND VPROZT > 50 .
    CLEAR:L_PERNR.
    L_PERNR = LT_STRUC-OBJID.
    CALL FUNCTION 'HR_PERSONAL_WORK_SCHEDULE'
      EXPORTING
        PERNR         = L_PERNR
        BEGDA         = I_BEGDA
        ENDDA         = I_ENDDA
      TABLES
        PERWS         = LT_PERWS
      EXCEPTIONS
        ERROR_OCCURED = 1
        ABORT_OCCURED = 2
        OTHERS        = 3.
    LOOP AT LT_PERWS WHERE ACTIV = 'X' AND TPROG = 'WORK' AND TAGTY <> '1' AND FTKLA <> '1'.
      OT_GZRL-PERNR = L_PERNR.
      OT_GZRL-BEGDA = LT_PERWS-DATUM.           "日期.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
        EXPORTING
          INPUT  = OT_GZRL-PERNR
        IMPORTING
          OUTPUT = OT_GZRL-PERNR.
      APPEND OT_GZRL.CLEAR OT_GZRL.
    ENDLOOP.

    "法假
    LOOP AT LT_PERWS WHERE ACTIV = 'X'  AND FTKLA = '1'.
      OT_GZRL1-PERNR = L_PERNR.
      OT_GZRL1-BEGDA = LT_PERWS-DATUM.           "日期.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
        EXPORTING
          INPUT  = OT_GZRL1-PERNR    
        IMPORTING
          OUTPUT = OT_GZRL1-PERNR.
      APPEND OT_GZRL1.CLEAR OT_GZRL1.
    ENDLOOP.
    "休息
    LOOP AT LT_PERWS WHERE ACTIV = 'X' AND TPROG = 'REST' AND TAGTY <> '1' .
      OT_GZRL2-PERNR = L_PERNR.
      OT_GZRL2-BEGDA = LT_PERWS-DATUM.           "日期.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
        EXPORTING
          INPUT  = OT_GZRL2-PERNR
        IMPORTING
          OUTPUT = OT_GZRL2-PERNR.
      APPEND OT_GZRL2.CLEAR OT_GZRL2.
    ENDLOOP.
    "周六
    LOOP AT LT_PERWS WHERE ACTIV = 'X'  AND TPROG = 'HALF'.
      OT_GZRL3-PERNR = L_PERNR.
      OT_GZRL3-BEGDA = LT_PERWS-DATUM.           "日期.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
        EXPORTING
          INPUT  = OT_GZRL3-PERNR
        IMPORTING
          OUTPUT = OT_GZRL3-PERNR.
      APPEND OT_GZRL3.CLEAR OT_GZRL3.
    ENDLOOP.

  ENDLOOP.

ENDFUNCTION.
